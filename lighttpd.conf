# using mod auth with plain text module mod_authn_file
# https://redmine.lighttpd.net/projects/lighttpd/wiki/How_to_set_up_a_git_server_over_http(s)

server.modules += ("mod_auth", "mod_authn_file")
server.modules += ("mod_setenv", "mod_cgi", "mod_alias")

server.feature-flags += ("server.graceful-restart-bg" => "enable")
server.feature-flags += ("server.graceful-shutdown-timeout" => 5)

server.document-root = "/home/git/www" 

## enable debugging
debug.log-request-header     = "enable"
debug.log-response-header    = "enable"
debug.log-request-handling   = "enable"
debug.log-file-not-found     = "enable"
debug.log-condition-handling = "enable"

$HTTP["url"] == "/create" {
    alias.url = ( "" => "/home/git/scripts/repo_maker.sh" )

    cgi.assign = ( "" => "" )
}
$HTTP["url"] =~ "/scm" {
    alias.url = ( "" => "/usr/lib/git-core/git-http-backend" )

    setenv.set-environment = ( "GIT_PROJECT_ROOT" => "/home/git" )
    setenv.set-environment += ( "GIT_HTTP_EXPORT_ALL" => "" )

    cgi.assign = ( "" => "" )
}

